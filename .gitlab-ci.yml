variables:
  DEBIAN_FRONTEND: noninteractive
  APT_GET_INSTALL: "apt-get install --no-install-recommends -q -y"

pre-commit:
  image:
    name: alpine:latest
  script:
    - date
    - apk add --no-cache bash gcc git libc-dev npm py3-pip python3-dev
    - pip3 install pre-commit
    - pre-commit --version
    - pre-commit run --all-files

test_alpine:
  image:
    name: alpine:latest
  script:
    - date
    # install dependencies:
    #   * bash for the script
    #   * patch to create src2ndesttol
    #   * rsync to run some tests
    - apk add --no-cache bash patch rsync
    - install -p -o root -g root -m 755 src2ndest /usr/local/bin/src2ndest
    - add-on/generate_tolerate_patch
    - install -p -o root -g root -m 755 src2ndesttol /usr/local/bin/src2ndesttol
    # run tests
    - test/run_tests

test_debian:
  image:
    name: debian:latest
  script:
    - date
    - apt-get update
    # install dependencies:
    #   * patch to create src2ndesttol
    #   * rsync to run some tests
    - $APT_GET_INSTALL patch rsync
    - install -p -o root -g root -m 755 src2ndest /usr/local/bin/src2ndest
    - add-on/generate_tolerate_patch
    - install -p -o root -g root -m 755 src2ndesttol /usr/local/bin/src2ndesttol
    # run tests
    - test/run_tests

test_freebsd:
  tags:
    - FreeBSD-13-amd64
  script:
    - date
    - pkg -v
    # install dependencies:
    #   * bash for the script
    #   * patch to create src2ndesttol
    #   * rsync to run some tests
    - pkg install -y bash patch rsync
    - install -p -o root -g wheel -m 755 src2ndest /usr/local/bin/src2ndest
    - add-on/generate_tolerate_patch
    - install -p -o root -g wheel -m 755 src2ndesttol /usr/local/bin/src2ndesttol
    # run tests
    - test/run_tests
